[{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":null,"dir":"","previous_headings":"","what":"surveytidy Package Development","title":"surveytidy Package Development","text":"Part surveyverse ecosystem — see ecosystem vision, architecture, surveytidy relates packages.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"project-overview","dir":"","previous_headings":"","what":"Project Overview","title":"surveytidy Package Development","text":"surveytidy provides dplyr/tidyr verbs survey design objects surveycore. extends tidyverse workflows work seamlessly complex survey designs, allowing users filter, select, mutate, group survey objects maintaining proper variance estimation metadata handling.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"package-information","dir":"","previous_headings":"","what":"Package Information","title":"surveytidy Package Development","text":"Name: surveytidy Purpose: dplyr/tidyr verbs survey objects (filter, select, mutate, rename, arrange, group_by, etc.) Target Audience: Survey researchers using tidyverse; users transitioning srvyr Current Status: Phase 0.5 (planning complete; implementation starting) License: GPL-3 (inherits surveycore) Dependencies: surveycore (imports core S7 classes)","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"vision--goals","dir":"","previous_headings":"","what":"Vision & Goals","title":"surveytidy Package Development","text":"surveytidy makes survey analysis feel natural tidyverse users : Domain-aware filtering — filter() marks rows /domain without removing Intelligent metadata handling — select() rename() update labels automatically Group-support — group_by() sets stratification Phase 1 estimation functions Familiar API — Users never write formula syntax; everything uses bare names (tidy-select)","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"key-design-decisions-finalized","dir":"","previous_headings":"","what":"Key Design Decisions (Finalized)","title":"surveytidy Package Development","text":"dplyr verbs map survey concepts — filter = domain, select = simplify data (remove non-design cols), mutate = add variables Metadata travels data — verbs update @variables @metadata keys Filter preserves rows — Uses domain column internally; never removes rows formula syntax — Always filter(design, age > 65), never filter(design, ~age > 65) S3 dispatch via registerS3method() — S7 methods; dplyr’s S3 dispatch works survey classes","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"dplyr-dispatch-pattern-critical","dir":"","previous_headings":"","what":"dplyr Dispatch Pattern (CRITICAL)","title":"surveytidy Package Development","text":"S7 namespaced class names break S3 dispatch. make dplyr verbs work: registers S3 method dplyr’s environment dispatch works. See R/00-zzz.R full setup.","code":"# In .onLoad(): registerS3method(   \"filter\", \"surveycore::survey_base\",   get(\"filter.survey_base\", envir = ns),   envir = asNamespace(\"dplyr\") )"},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"file-organization-r","dir":"","previous_headings":"Architecture","what":"File Organization (R/)","title":"surveytidy Package Development","text":"","code":"R/ ├── 00-zzz.R                # .onLoad(): S3 method registration + S7::methods_register() ├── 01-filter.R             # filter.survey_base, dplyr_reconstruct.survey_base ├── 02-select.R             # select.survey_base, pull.survey_base, glimpse.survey_base ├── 03-mutate.R             # mutate.survey_base (warns on weight column modification) ├── 04-rename.R             # rename.survey_base (auto-updates @variables + @metadata keys) ├── 05-arrange.R            # arrange.survey_base, slice_*.survey_base ├── 06-group-by.R           # group_by.survey_base, ungroup.survey_base ├── 07-tidyr.R              # drop_na(), separate_*(), unite() (stretch goals) ├── 08-joins.R              # *_join() (stretch goals) └── surveytidy-package.R    # Package-level documentation + @importFrom dplyr"},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"test-organization-teststestthat","dir":"","previous_headings":"Architecture","what":"Test Organization (tests/testthat/)","title":"surveytidy Package Development","text":"","code":"tests/testthat/ ├── helper-test-data.R      # Shared test data generators (copied from surveycore) ├── test-filter.R           # filter() and related domain operations ├── test-select.R           # select(), pull(), glimpse() ├── test-mutate.R           # mutate() behavior + weight column warnings ├── test-rename.R           # rename() + automatic metadata updates ├── test-arrange.R          # arrange(), slice_*() ├── test-group-by.R         # group_by(), ungroup() └── test-tidyr.R            # tidyr functions (drop_na, separate, unite)"},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"domain-column","dir":"","previous_headings":"Architecture > Key Concepts","what":"Domain Column","title":"surveytidy Package Development","text":"Name: \"..surveycore_domain..\" (use surveycore::SURVEYCORE_DOMAIN_COL) Type: logical column @data Content: TRUE -domain rows, FALSE --domain rows Never removed; created/updated filter()","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"visible_vars","dir":"","previous_headings":"Architecture > Key Concepts","what":"visible_vars","title":"surveytidy Package Development","text":"Key @variables$visible_vars Set select() user’s explicit column selection Controls columns print() shows (hides design vars display) NULL means columns @data shown (default) select(), @data contains design vars + user-selected cols; visible_vars tracks user’s selection design vars hidden print","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"groups","dir":"","previous_headings":"Architecture > Key Concepts","what":"@groups","title":"surveytidy Package Development","text":"Reserved Phase 0.5 (now used group_by()) Populated group_by(), cleared ungroup() used Phase 1 estimation functions","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"dplyr_reconstruct","dir":"","previous_headings":"Architecture > Key Concepts","what":"dplyr_reconstruct()","title":"surveytidy Package Development","text":"Required complex pipelines (joins, across(), slice, etc.) Rebuilds survey class reconstructed data + original template Errors design variables removed","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"before-starting-any-implementation","dir":"","previous_headings":"","what":"Before Starting Any Implementation","title":"surveytidy Package Development","text":"Read files first — order — writing code: Shared standards (surveyverse packages follow ): 1. ../survey-standards/.claude/rules/code-style.md — indentation, S7 method syntax, error conventions, function design 2. ../survey-standards/.claude/rules/testing-standards.md — test structure, coverage requirements, assertion patterns 3. ../survey-standards/.claude/rules/r-package-conventions.md — roxygen2, NAMESPACE, exports, R CMD check hygiene 4. ../survey-standards/.claude/rules/github-strategy.md — branching model, commit format, PR workflow 5. ../survey-standards/.claude/rules/changelog-workflow.md — changelog entries (required every PR) decisions log (required plan mode) Package-specific (surveytidy ): - .claude/rules/ — package-specific rules extensions reference: - ../surveycore/CLAUDE.md — surveycore architecture (survey class structure, @data/@variables/@metadata) - ../surveycore/plans/ — error-messages.md, formal spec, implementation plan","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"phase-05-build-order","dir":"","previous_headings":"","what":"Phase 0.5 Build Order","title":"surveytidy Package Development","text":"feature/filter — R/01-filter.R + tests/testthat/test-filter.R feature/select — R/02-select.R + tests/testthat/test-select.R feature/mutate — R/03-mutate.R + tests/testthat/test-mutate.R feature/rename — R/04-rename.R + tests/testthat/test-rename.R feature/arrange — R/05-arrange.R + tests/testthat/test-arrange.R feature/group-— R/06-group-.R + tests/testthat/test-group-.R feature/tidyr — R/07-tidyr.R + tests/testthat/test-tidyr.R (stretch) feature/joins — R/08-joins.R + tests/testthat/test-joins.R (stretch)","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"filter-specifics","dir":"","previous_headings":"Key Implementation Details","what":"filter() Specifics","title":"surveytidy Package Development","text":"Stores conditions @variables$domain (list quosures) Chained filters masks: existing_domain & new_mask Empty domain (FALSE) triggers surveycore_warning_empty_domain .argument supported; raises surveycore_error_filter_by_unsupported","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"select-specifics","dir":"","previous_headings":"Key Implementation Details","what":"select() Specifics","title":"surveytidy Package Development","text":"Physically removes non-selected, non-design columns @data Always keeps design variables @data (weights, strata, PSU, FPC, repweights, domain column) — required variance estimation Sets @variables$visible_vars user’s selection — hides design vars print output (’re @data user’s selection) Normalises visible_vars NULL result empty (e.g. user selects design variables) — NULL means “show columns @data” Deletes @metadata entries physically removed columns select() irreversible within pipeline: removed columns gone","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"rename-specifics","dir":"","previous_headings":"Key Implementation Details","what":"rename() Specifics","title":"surveytidy Package Development","text":"Uses surveycore:::.update_design_var_names() update @variables keys Uses surveycore:::.rename_metadata_keys() update @metadata keys Warns (error) user renames design variable; updates @variables track new column name (surveytidy_warning_rename_design_var)","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"dplyr_reconstruct-1","dir":"","previous_headings":"Key Implementation Details","what":"dplyr_reconstruct()","title":"surveytidy Package Development","text":"Called dplyr complex operations (joins, across(), slice, etc.) Must rebuild survey class data + template Errors surveycore_error_design_var_removed design cols deleted","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"subsetsurvey_base","dir":"","previous_headings":"Key Implementation Details","what":"subset.survey_base","title":"surveytidy Package Development","text":"Physical subsetting (actually removes rows, unlike filter) Always issues surveycore_warning_physical_subset Registered via NAMESPACE (base R generic, dplyr)","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"working-with-this-codebase","dir":"","previous_headings":"","what":"Working With This Codebase","title":"surveytidy Package Development","text":"Follow established patterns — consistency surveycore matters Update metadata automatically — verbs handle @variables/@metadata updates Test combinations — verb tested three design types (taylor, replicate, twophase) Check domain preservation — domain column survive operations intact Provide complete code blocks — ready copy use Include tests — always provide corresponding tests new verbs","code":""},{"path":"https://jdenn0514.github.io/surveytidy/CLAUDE.html","id":"reference-documents","dir":"","previous_headings":"","what":"Reference Documents","title":"surveytidy Package Development","text":"planning documents plans/: - (Currently minimal; grow Phase 0.5 proceeds) finalized decisions ../survey-standards/.claude/rules/: - code-style.md — R style, S7 patterns, error conventions, function design - testing-standards.md — test structure, coverage, assertion patterns, test data - r-package-conventions.md — roxygen2, NAMESPACE, exports, R CMD check hygiene - github-strategy.md — branching, commits, PRs, CI/CD, release process Always defer surveycore’s CLAUDE.md survey class internals. surveytidy add-layer.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Jacob Dennen. Author, maintainer.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Dennen J (2026). surveytidy: Tidy dplyr/tidyr Verbs Survey Design Objects. R package version 0.1.0, https://jdenn0514.github.io/surveytidy/.","code":"@Manual{,   title = {surveytidy: Tidy dplyr/tidyr Verbs for Survey Design Objects},   author = {Jacob Dennen},   year = {2026},   note = {R package version 0.1.0},   url = {https://jdenn0514.github.io/surveytidy/}, }"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"surveytidy","dir":"","previous_headings":"","what":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"surveytidy provides dplyr tidyr verbs survey design objects created surveycore package. makes survey analysis feel natural tidyverse users:","code":"library(surveycore) library(surveytidy)  # Build a survey design d <- as_survey(nhanes, ids = sdmvpsu, strata = sdmvstra,                weights = wtmec2yr, nest = TRUE)  # Use familiar dplyr verbs — survey design is preserved automatically adults <- d |>   filter(ridageyr >= 18) |>        # domain estimation, not row removal   select(ridageyr, bmxbmi, riagendr) |>   group_by(riagendr) |>   mutate(bmi_centered = bmxbmi - mean(bmxbmi, na.rm = TRUE))"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"key-idea-filter-marks-rows-never-removes-them","dir":"","previous_headings":"","what":"Key idea: filter() marks rows, never removes them","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"important statistical feature surveytidy filter() uses domain estimation rather physical subsetting: call filter(), surveytidy writes logical column ..surveycore_domain.. data. Phase 1 estimation functions read column restrict calculations domain retaining rows correct variance estimation.","code":"# This keeps all 9,756 rows — variance estimation stays correct women <- d |> filter(riagendr == 2) nrow(women@data)  #> 9756  # This physically removes rows — variance estimates for women would be wrong wrong <- subset(d, riagendr == 2)  # issues a warning"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"","code":"# install.packages(\"pak\") pak::pak(\"JDenn0514/surveycore\")  # required first pak::pak(\"JDenn0514/surveytidy\")"},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"filtering-domain-estimation","dir":"","previous_headings":"Usage","what":"Filtering (domain estimation)","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"","code":"# Single condition adults <- d |> filter(ridageyr >= 18)  # Chained filters AND the conditions together adult_women <- d |>   filter(ridageyr >= 18) |>   filter(riagendr == 2)  # Equivalent — both produce identical domain columns adult_women2 <- d |> filter(ridageyr >= 18, riagendr == 2)"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"selecting-columns","dir":"","previous_headings":"Usage","what":"Selecting columns","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"","code":"# Design variables (weights, strata, PSU) are always kept in @data # even when not selected — they are required for variance estimation d2 <- select(d, ridageyr, bmxbmi, riagendr)  # Design variables are hidden from print() but still present print(d2)     # shows ridageyr, bmxbmi, riagendr only d2@data$wt    # still accessible  # Reorder visible columns d3 <- relocate(d2, riagendr, .before = ridageyr)"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"mutating","dir":"","previous_headings":"Usage","what":"Mutating","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"","code":"# Add new columns d |> mutate(bmi_kg_m2 = bmxbmi,             age_group  = cut(ridageyr, c(0, 18, 40, 65, Inf)))  # Modifying a design variable warns you d |> mutate(wtmec2yr = wtmec2yr * 0.5) #> Warning: mutate() modified design variable(s): `wtmec2yr`  # Grouped mutate via group_by() d |>   group_by(riagendr) |>   mutate(bmi_pctile = rank(bmxbmi) / n())"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"renaming","dir":"","previous_headings":"Usage","what":"Renaming","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"","code":"# @variables and @metadata stay in sync automatically d |> rename(age = ridageyr, bmi = bmxbmi)"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"sorting","dir":"","previous_headings":"Usage","what":"Sorting","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"","code":"# Rows sort; domain column moves with them d |>   filter(ridageyr >= 18) |>   arrange(bmxbmi)  # Sort by group first, then by value d |>   group_by(riagendr) |>   arrange(bmxbmi, .by_group = TRUE)"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"grouping","dir":"","previous_headings":"Usage","what":"Grouping","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"","code":"d2 <- group_by(d, riagendr)         # set groups d3 <- group_by(d2, ridageyr, .add = TRUE)  # add to groups d4 <- ungroup(d3, riagendr)         # partial ungroup d5 <- ungroup(d3)                   # remove all groups"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"physical-row-operations-use-sparingly","dir":"","previous_headings":"Usage","what":"Physical row operations (use sparingly)","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"","code":"# These physically remove rows and always issue a warning. # Use filter() instead for subpopulation analyses. slice_head(d, n = 100)    # first 100 rows drop_na(d, bmxbmi)        # remove rows with NA in bmxbmi"},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"relationship-to-surveycore","dir":"","previous_headings":"","what":"Relationship to surveycore","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"surveytidy add-layer. surveycore provides: S7 survey design classes (survey_taylor, survey_replicate, survey_twophase) Constructors (as_survey(), as_survey_rep(), as_survey_twophase()) Metadata system (variable labels, value labels, question prefaces) surveytidy provides dplyr/tidyr interface top classes. Phase 1 (development) add estimation functions (get_mean(), get_total(), etc.) respect domain column @groups set surveytidy verbs.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/index.html","id":"license","dir":"","previous_headings":"","what":"License","title":"surveytidy — Tidy dplyr/tidyr Verbs for Survey Design Objects","text":"GPL-3","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/arrange.survey_base.html","id":null,"dir":"Reference","previous_headings":"","what":"Sort rows and physically select rows of a survey design object — arrange.survey_base","title":"Sort rows and physically select rows of a survey design object — arrange.survey_base","text":"arrange() sorts rows @data. domain column moves rows — update @variables$domain needed. Supports .by_group = TRUE using @groups set dplyr::group_by(). slice(), slice_head(), slice_tail(), slice_min(), slice_max(), slice_sample() physically remove rows always issue surveycore_warning_physical_subset. error result 0 rows. Prefer dplyr::filter() subpopulation analyses. slice_sample(weight_by = ) additionally warns surveytidy_warning_slice_sample_weight_by weight_by column independent survey design weights.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/arrange.survey_base.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Sort rows and physically select rows of a survey design object — arrange.survey_base","text":"","code":"# S3 method for class 'survey_base' arrange(.data, ..., .by_group = FALSE)  # S3 method for class 'survey_base' slice(.data, ...)  # S3 method for class 'survey_base' slice_head(.data, ...)  # S3 method for class 'survey_base' slice_tail(.data, ...)  # S3 method for class 'survey_base' slice_min(.data, ...)  # S3 method for class 'survey_base' slice_max(.data, ...)  # S3 method for class 'survey_base' slice_sample(.data, ...)"},{"path":"https://jdenn0514.github.io/surveytidy/reference/arrange.survey_base.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Sort rows and physically select rows of a survey design object — arrange.survey_base","text":".data survey design object. ... arrange(): <data-masking> variables expressions sort . slice_*(): passed corresponding dplyr::slice_*() function. .by_group Logical. TRUE @groups set, rows sorted grouping variables first, ....","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/arrange.survey_base.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Sort rows and physically select rows of a survey design object — arrange.survey_base","text":"survey object rows reordered (arrange()) physical subset rows (slice_*()).","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/arrange.survey_base.html","id":"functions","dir":"Reference","previous_headings":"","what":"Functions","title":"Sort rows and physically select rows of a survey design object — arrange.survey_base","text":"slice(survey_base): Select rows position. slice_head(survey_base): Select first n rows. slice_tail(survey_base): Select last n rows. slice_min(survey_base): Select rows smallest values. slice_max(survey_base): Select rows largest values. slice_sample(survey_base): Randomly sample rows.","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/reference/arrange.survey_base.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Sort rows and physically select rows of a survey design object — arrange.survey_base","text":"","code":"df <- data.frame(y = rnorm(100), wt = runif(100, 1, 5),                  g = sample(c(\"A\",\"B\"), 100, TRUE)) d  <- surveycore::as_survey(df, weights = wt)  # Sort rows d2 <- arrange(d, y) #> Error in arrange(d, y): could not find function \"arrange\" d3 <- arrange(d, desc(y)) #> Error in arrange(d, desc(y)): could not find function \"arrange\"  # Physical row selection (issues warning) d4 <- suppressWarnings(slice_head(d, n = 20)) #> Error in slice_head(d, n = 20): could not find function \"slice_head\""},{"path":"https://jdenn0514.github.io/surveytidy/reference/drop_na.survey_base.html","id":null,"dir":"Reference","previous_headings":"","what":"Remove rows containing missing values from a survey design object — drop_na.survey_base","title":"Remove rows containing missing values from a survey design object — drop_na.survey_base","text":"Physically removes rows specified columns contain NA. columns specified, NA column triggers removal. Always issues surveycore_warning_physical_subset. Errors rows removed. Prefer dplyr::filter() !.na(col) subpopulation analyses — keeps rows gives correct variance estimates.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/drop_na.survey_base.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Remove rows containing missing values from a survey design object — drop_na.survey_base","text":"","code":"# S3 method for class 'survey_base' drop_na(data, ...)"},{"path":"https://jdenn0514.github.io/surveytidy/reference/drop_na.survey_base.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Remove rows containing missing values from a survey design object — drop_na.survey_base","text":"data survey design object. ... <tidy-select> Columns inspect NA. empty, columns checked.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/drop_na.survey_base.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Remove rows containing missing values from a survey design object — drop_na.survey_base","text":"survey object rows containing NA selected columns removed.","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/reference/drop_na.survey_base.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Remove rows containing missing values from a survey design object — drop_na.survey_base","text":"","code":"df <- data.frame(y = c(rnorm(99), NA), wt = runif(100, 1, 5)) d  <- surveycore::as_survey(df, weights = wt)  # Remove rows with NA in y d2 <- suppressWarnings(drop_na(d, y)) #> Error in drop_na(d, y): could not find function \"drop_na\" nrow(d2@data)  # 99 #> Error: object 'd2' not found"},{"path":"https://jdenn0514.github.io/surveytidy/reference/filter.survey_base.html","id":null,"dir":"Reference","previous_headings":"","what":"Filter survey data using domain estimation — filter.survey_base","title":"Filter survey data using domain estimation — filter.survey_base","text":"Mark rows -domain without removing . Unlike base::subset() plain data-frame filter, filter() never removes rows survey object. Instead writes logical column ..surveycore_domain.. @data. Variance estimation therefore uses rows — full design intact — analysis restricted domain. Chained filter() calls conditions together: filter(d, ) |> filter(d, B) identical filter(d, , B). Physically removes rows survey data condition evaluates FALSE. Unlike dplyr::filter(), changes underlying design can bias variance estimates.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/filter.survey_base.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Filter survey data using domain estimation — filter.survey_base","text":"","code":"# S3 method for class 'survey_base' filter(.data, ..., .by = NULL, .preserve = FALSE)  # S3 method for class 'survey_base' subset(x, condition, ...)"},{"path":"https://jdenn0514.github.io/surveytidy/reference/filter.survey_base.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Filter survey data using domain estimation — filter.survey_base","text":".data survey_taylor, survey_replicate, survey_twophase object created surveycore::as_survey(). ... Ignored (compatibility base subset() signature). .supported survey objects. Use dplyr::group_by() instead. .preserve Ignored (included compatibility dplyr generic signature). x survey design object. condition logical expression evaluated x@data.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/filter.survey_base.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Filter survey data using domain estimation — filter.survey_base","text":"survey object updated ..surveycore_domain.. column @data. Row count unchanged. survey object class matching rows retained.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/filter.survey_base.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Filter survey data using domain estimation — filter.survey_base","text":"subpopulation analyses, use dplyr::filter() instead. use subset() explicitly built survey design subset population.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/filter.survey_base.html","id":"functions","dir":"Reference","previous_headings":"","what":"Functions","title":"Filter survey data using domain estimation — filter.survey_base","text":"subset(survey_base): Physically remove rows (use sparingly). Always issues surveycore_warning_physical_subset. Prefer filter() subpopulation analyses.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/filter.survey_base.html","id":"domain-estimation-vs-physical-subsetting","dir":"Reference","previous_headings":"","what":"Domain estimation vs. physical subsetting","title":"Filter survey data using domain estimation — filter.survey_base","text":"filter() correct tool subpopulation analyses. Physically removing rows (via base::subset(), subset(), dplyr::slice()) changes units contribute variance estimation yields incorrect standard errors. See Thomas Lumley's note details: https://notstatschat.rbind.io/2021/07/22/subsets--subpopulations--survey-inference","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/reference/filter.survey_base.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Filter survey data using domain estimation — filter.survey_base","text":"","code":"df <- data.frame(y = rnorm(100), x = runif(100),                  wt = runif(100, 1, 5), g = sample(c(\"A\",\"B\"), 100, TRUE)) d  <- surveycore::as_survey(df, weights = wt)  # Single condition d_pos <- filter(d, y > 0) #> Error in attr(data, \"tsp\") <- c(start, end, frequency): object is not a matrix  # Multiple conditions (AND-ed) d_sub <- filter(d, y > 0, g == \"A\") #> Error: object 'g' not found  # Chained filters produce the same domain column d_chain <- filter(d, y > 0) |> filter(g == \"A\") #> Error in attr(data, \"tsp\") <- c(start, end, frequency): object is not a matrix identical(d_sub@data[[surveycore::SURVEYCORE_DOMAIN_COL]],           d_chain@data[[surveycore::SURVEYCORE_DOMAIN_COL]]) #> Error: object 'd_sub' not found"},{"path":"https://jdenn0514.github.io/surveytidy/reference/group_by.survey_base.html","id":null,"dir":"Reference","previous_headings":"","what":"Group and ungroup a survey design object — group_by.survey_base","title":"Group and ungroup a survey design object — group_by.survey_base","text":"group_by() stores grouping column names @groups. Unlike dplyr, grouped_df attribute attached @data — grouping kept survey object . Phase 1 estimation functions dplyr::mutate() read @groups apply grouped calculations. ungroup() arguments removes groups. column arguments performs partial ungroup, removing named columns @groups.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/group_by.survey_base.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Group and ungroup a survey design object — group_by.survey_base","text":"","code":"# S3 method for class 'survey_base' group_by(.data, ..., .add = FALSE, .drop = dplyr::group_by_drop_default(.data))  # S3 method for class 'survey_base' ungroup(x, ...)"},{"path":"https://jdenn0514.github.io/surveytidy/reference/group_by.survey_base.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Group and ungroup a survey design object — group_by.survey_base","text":".data survey design object. ... <data-masking> Variables group . Computed expressions (e.g., cut(age, breaks)) supported. .add Logical. TRUE, add existing groups rather replacing . .drop Passed dplyr::group_by_drop_default(). x survey design object (ungroup()).","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/group_by.survey_base.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Group and ungroup a survey design object — group_by.survey_base","text":"survey object @groups updated.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/group_by.survey_base.html","id":"functions","dir":"Reference","previous_headings":"","what":"Functions","title":"Group and ungroup a survey design object — group_by.survey_base","text":"ungroup(survey_base): Remove grouping variables.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/group_by.survey_base.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Group and ungroup a survey design object — group_by.survey_base","text":"","code":"df <- data.frame(y = rnorm(100), wt = runif(100, 1, 5),                  region = sample(c(\"N\",\"S\",\"E\",\"W\"), 100, TRUE)) d  <- surveycore::as_survey(df, weights = wt)  # Group and then compute group means via mutate() d2 <- d |>   group_by(region) |>   mutate(region_mean = mean(y)) #> Error in mutate(group_by(d, region), region_mean = mean(y)): could not find function \"mutate\"  # Partial ungroup d3 <- group_by(d, region) #> Error in group_by(d, region): could not find function \"group_by\" d4 <- ungroup(d3)          # remove all groups #> Error in ungroup(d3): could not find function \"ungroup\""},{"path":"https://jdenn0514.github.io/surveytidy/reference/mutate.survey_base.html","id":null,"dir":"Reference","previous_headings":"","what":"Add or modify columns of a survey design object — mutate.survey_base","title":"Add or modify columns of a survey design object — mutate.survey_base","text":"Delegates dplyr::mutate() @data, : Re-attaches design variables dropped .keep = \"none\" .keep = \"used\". Appends newly created columns @variables$visible_vars set. Records transformation expression new columns @metadata@transformations. Respects @groups set dplyr::group_by() — pass .= NULL (default) grouping group_by() applied automatically.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/mutate.survey_base.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Add or modify columns of a survey design object — mutate.survey_base","text":"","code":"# S3 method for class 'survey_base' mutate(   .data,   ...,   .by = NULL,   .keep = c(\"all\", \"used\", \"unused\", \"none\"),   .before = NULL,   .after = NULL )"},{"path":"https://jdenn0514.github.io/surveytidy/reference/mutate.survey_base.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Add or modify columns of a survey design object — mutate.survey_base","text":".data survey design object. ... <data-masking> Name-value pairs. name gives new column name; value expression evaluated @data. .used directly — use dplyr::group_by() instead. @groups set .NULL, @groups used effective grouping. .keep columns retain. One \"\" (default), \"used\", \"unused\", \"none\". Design variables always re-attached regardless .keep. ., .<tidy-select> Optionally position new columns existing one.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/mutate.survey_base.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Add or modify columns of a survey design object — mutate.survey_base","text":"survey object updated @data, @variables$visible_vars, @metadata@transformations.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/mutate.survey_base.html","id":"detecting-design-variable-modification","dir":"Reference","previous_headings":"","what":"Detecting design variable modification","title":"Add or modify columns of a survey design object — mutate.survey_base","text":"left-hand side mutation names design variable (e.g., mutate(d, wt = wt * 2)), surveytidy_warning_mutate_design_var warning issued. Detection name-based — across() calls happen modify design variables trigger warning.","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/reference/mutate.survey_base.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Add or modify columns of a survey design object — mutate.survey_base","text":"","code":"df <- data.frame(y = rnorm(100), wt = runif(100, 1, 5),                  g = sample(c(\"A\",\"B\"), 100, TRUE)) d  <- surveycore::as_survey(df, weights = wt)  # Add a new column d2 <- mutate(d, y_sq = y^2) #> Error in mutate(d, y_sq = y^2): could not find function \"mutate\"  # Grouped mutate d3 <- d |>   group_by(g) |>   mutate(g_mean = mean(y)) #> Error in mutate(group_by(d, g), g_mean = mean(y)): could not find function \"mutate\""},{"path":"https://jdenn0514.github.io/surveytidy/reference/rename.survey_base.html","id":null,"dir":"Reference","previous_headings":"","what":"Rename columns of a survey design object — rename.survey_base","title":"Rename columns of a survey design object — rename.survey_base","text":"Renames columns @data automatically keeps survey design sync: @variables — design variable column names (weights, strata, PSU, FPC, replicate weights) updated new names. @metadata — variable labels, value labels, question prefaces, notes, transformation records re-keyed. @variables$visible_vars — occurrence old name replaced new name. Renaming design variable allowed issues surveytidy_warning_rename_design_var confirm design updated.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/rename.survey_base.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Rename columns of a survey design object — rename.survey_base","text":"","code":"# S3 method for class 'survey_base' rename(.data, ...)"},{"path":"https://jdenn0514.github.io/surveytidy/reference/rename.survey_base.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Rename columns of a survey design object — rename.survey_base","text":".data survey design object. ... <tidy-select> Use new_name = old_name pairs rename columns.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/rename.survey_base.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Rename columns of a survey design object — rename.survey_base","text":"survey object updated column names, @variables, @metadata.","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/reference/rename.survey_base.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Rename columns of a survey design object — rename.survey_base","text":"","code":"df <- data.frame(y1 = rnorm(50), y2 = rnorm(50),                  wt = runif(50, 1, 5)) d  <- surveycore::as_survey(df, weights = wt)  # Rename an outcome column d2 <- rename(d, outcome = y1) #> Error in rename(d, outcome = y1): could not find function \"rename\"  # Rename a design variable (warns and updates @variables$weights) d3 <- rename(d, weight = wt) #> Error in rename(d, weight = wt): could not find function \"rename\" d3@variables$weights  # \"weight\" #> Error: object 'd3' not found"},{"path":"https://jdenn0514.github.io/surveytidy/reference/select.survey_base.html","id":null,"dir":"Reference","previous_headings":"","what":"Select, relocate, pull, and glimpse columns of a survey design object — select.survey_base","title":"Select, relocate, pull, and glimpse columns of a survey design object — select.survey_base","text":"select() chooses columns keep, always retaining design variables (weights, strata, PSU, FPC, replicate weights) even explicitly selected. user's selection recorded @variables$visible_vars print() hides design columns. relocate() reorders visible_vars set; reorders @data otherwise. pull() extracts column plain vector (terminal — result survey object). glimpse() prints concise column summary, respecting visible_vars.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/select.survey_base.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Select, relocate, pull, and glimpse columns of a survey design object — select.survey_base","text":"","code":"# S3 method for class 'survey_base' select(.data, ...)  # S3 method for class 'survey_base' relocate(.data, ..., .before = NULL, .after = NULL)  # S3 method for class 'survey_base' pull(.data, var = -1, name = NULL, ...)  # S3 method for class 'survey_base' glimpse(x, width = NULL, ...)"},{"path":"https://jdenn0514.github.io/surveytidy/reference/select.survey_base.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Select, relocate, pull, and glimpse columns of a survey design object — select.survey_base","text":".data survey design object. ... <tidy-select> Columns select / reorder. pull(), column extract. ., .<tidy-select> Destination relocated columns (passed dplyr::relocate()). var <data-masking> Column pull. Defaults last column. name <data-masking> Optional column use names returned vector. x survey design object (glimpse()). width Width output, passed dplyr::glimpse().","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/select.survey_base.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Select, relocate, pull, and glimpse columns of a survey design object — select.survey_base","text":"select(), relocate(): survey object updated @data /@variables$visible_vars. pull(): plain vector (survey object). glimpse(): x invisibly.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/select.survey_base.html","id":"functions","dir":"Reference","previous_headings":"","what":"Functions","title":"Select, relocate, pull, and glimpse columns of a survey design object — select.survey_base","text":"relocate(survey_base): Reorder columns. pull(survey_base): Extract column vector. glimpse(survey_base): Print concise column summary.","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/reference/select.survey_base.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Select, relocate, pull, and glimpse columns of a survey design object — select.survey_base","text":"","code":"df <- data.frame(y1 = rnorm(50), y2 = rnorm(50),                  wt = runif(50, 1, 5), g = sample(c(\"A\",\"B\"), 50, TRUE)) d  <- surveycore::as_survey(df, weights = wt)  # select() keeps design vars even though only y1, y2 are named d2 <- select(d, y1, y2) #> Error in select(d, y1, y2): could not find function \"select\" names(d2@data)               # includes wt (design var) #> Error: object 'd2' not found d2@variables$visible_vars    # c(\"y1\", \"y2\") #> Error: object 'd2' not found  # relocate() moves y2 before y1 in the visible columns d3 <- relocate(d2, y2, .before = y1) #> Error in relocate(d2, y2, .before = y1): could not find function \"relocate\"  # pull() returns a plain numeric vector pull(d, y1) #> Error in pull(d, y1): could not find function \"pull\"  # glimpse() respects visible_vars glimpse(d2) #> Error in glimpse(d2): could not find function \"glimpse\""},{"path":"https://jdenn0514.github.io/surveytidy/reference/surveytidy-package.html","id":null,"dir":"Reference","previous_headings":"","what":"surveytidy: Tidy dplyr/tidyr Verbs for Survey Design Objects — surveytidy-package","title":"surveytidy: Tidy dplyr/tidyr Verbs for Survey Design Objects — surveytidy-package","text":"Provides dplyr tidyr verbs survey design objects created surveycore package. key statistical feature domain-aware filtering: filter() marks rows -domain rather removing , essential correct variance estimation subpopulation statistics.","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/reference/surveytidy-package.html","id":"key-verbs","dir":"Reference","previous_headings":"","what":"Key verbs","title":"surveytidy: Tidy dplyr/tidyr Verbs for Survey Design Objects — surveytidy-package","text":"dplyr::filter() — domain estimation (marks rows, never removes ) dplyr::select() — column selection preserving design variables dplyr::mutate() — add/modify columns weight-change warnings dplyr::rename() — auto-updates design variable names metadata dplyr::group_by() / dplyr::ungroup() — grouped analysis support dplyr::arrange() — row sorting preserving domain membership subset() — physical row removal strong warning","code":""},{"path":"https://jdenn0514.github.io/surveytidy/reference/surveytidy-package.html","id":"domain-estimation-vs-physical-subsetting","dir":"Reference","previous_headings":"","what":"Domain estimation vs. physical subsetting","title":"surveytidy: Tidy dplyr/tidyr Verbs for Survey Design Objects — surveytidy-package","text":"filter() subset() fundamentally different statistical meanings: filter(.data, condition) — sets ..surveycore_domain.. TRUE matching rows. rows retained. Variance estimation correctly uses full design. subset(.data, condition) — physically removes non-matching rows. Variance estimates biased unless design explicitly built subset. Use understand statistical implications.","code":""},{"path":[]},{"path":"https://jdenn0514.github.io/surveytidy/reference/surveytidy-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"surveytidy: Tidy dplyr/tidyr Verbs for Survey Design Objects — surveytidy-package","text":"Maintainer: Jacob Dennen jacob.dennen@example.com","code":""},{"path":"https://jdenn0514.github.io/surveytidy/news/index.html","id":"surveytidy-010","dir":"Changelog","previous_headings":"","what":"surveytidy 0.1.0","title":"surveytidy 0.1.0","text":"First release. Implements complete set dplyr tidyr verbs survey design objects created surveycore package.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/news/index.html","id":"new-verbs-0-1-0","dir":"Changelog","previous_headings":"","what":"New verbs","title":"surveytidy 0.1.0","text":"filter() — domain-aware filtering. Marks rows -domain rather removing , preserving correct variance estimation subpopulation analyses. Chained filter() calls conditions together. select() — column selection. Physically removes non-selected columns always retaining design variables (weights, strata, PSU, FPC, replicate weights). Sets @variables$visible_vars print() hides design columns user explicitly request. relocate() — column reordering. Reorders visible_vars prior select() called; reorders @data directly otherwise. pull() — extract column plain vector (terminal operation). glimpse() — concise column summary, respecting visible_vars. mutate() — add modify columns. Re-attaches design variables dropped .keep = \"none\" .keep = \"used\". Issues surveytidy_warning_mutate_design_var mutation’s left-hand side names design variable. Respects @groups set group_by(). rename() — rename columns. Automatically keeps @variables (design specification) @metadata (variable labels, value labels, etc.) sync new column names. Issues surveytidy_warning_rename_design_var design variable renamed. arrange() — row sorting. domain column moves correctly rows sorting. Supports .by_group = TRUE using @groups. slice(), slice_head(), slice_tail(), slice_min(), slice_max(), slice_sample() — physical row selection surveycore_warning_physical_subset warning. slice_sample(weight_by = ) additionally issues surveytidy_warning_slice_sample_weight_by flag weight_by column independent survey design weights. group_by() — store grouping columns @groups. attach grouped_df attribute @data; grouping kept survey object. Supports .add = TRUE incremental grouping computed expressions (e.g., group_by(d, above_median = y1 > median(y1))). ungroup() — remove groups (arguments) remove specific columns @groups (partial ungroup). drop_na() — physical row removal rows NA specified columns (column). Issues surveycore_warning_physical_subset. subset() — physical row removal surveycore_warning_physical_subset. Prefer filter() subpopulation analyses.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/news/index.html","id":"statistical-design-0-1-0","dir":"Changelog","previous_headings":"","what":"Statistical design","title":"surveytidy 0.1.0","text":"key design decision surveytidy filter() never removes rows. Removing rows survey design changes units contribute variance estimation produces incorrect standard errors subpopulation statistics. filter() instead writes logical domain column (..surveycore_domain..) @data. Phase 1 estimation functions read column restrict calculations domain retaining rows variance estimation.","code":""},{"path":"https://jdenn0514.github.io/surveytidy/news/index.html","id":"infrastructure-0-1-0","dir":"Changelog","previous_headings":"","what":"Infrastructure","title":"surveytidy 0.1.0","text":"dplyr_reconstruct.survey_base() ensures complex dplyr pipelines (joins, across(), internal slice operations) return survey objects rather plain tibbles. Errors surveycore_error_design_var_removed pipeline drops design variable. Invariant 6 added test_invariants(): every column name listed @variables$visible_vars must exist @data.","code":""}]
