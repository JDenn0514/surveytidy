% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mutate.R
\name{mutate.survey_base}
\alias{mutate.survey_base}
\title{Add or modify columns of a survey design object}
\usage{
mutate.survey_base(
  .data,
  ...,
  .by = NULL,
  .keep = c("all", "used", "unused", "none"),
  .before = NULL,
  .after = NULL
)
}
\arguments{
\item{.data}{A survey design object.}

\item{...}{<\code{\link[rlang:args_data_masking]{data-masking}}> Name-value pairs.
The name gives the new column name; the value is an expression evaluated
against \verb{@data}.}

\item{.by}{Not used directly — use \code{\link[=group_by]{group_by()}} instead. If \verb{@groups} is
set and \code{.by} is \code{NULL}, \verb{@groups} is used as the effective grouping.}

\item{.keep}{Which columns to retain. One of \code{"all"} (default), \code{"used"},
\code{"unused"}, or \code{"none"}. Design variables are always re-attached
regardless of \code{.keep}.}

\item{.before, .after}{<\code{\link[tidyselect:language]{tidy-select}}> Optionally
position new columns before or after an existing one.}
}
\value{
The survey object with updated \verb{@data}, \verb{@variables$visible_vars},
and \verb{@metadata@transformations}.
}
\description{
Delegates to \code{dplyr::mutate()} on \verb{@data}, then:
\itemize{
\item Re-attaches any design variables dropped by \code{.keep = "none"} or
\code{.keep = "used"}.
\item Appends newly created columns to \verb{@variables$visible_vars} when it is set.
\item Records the transformation expression for new columns in
\verb{@metadata@transformations}.
\item Respects \verb{@groups} set by \code{\link[=group_by]{group_by()}} — pass \code{.by = NULL} (the default)
and grouping from \code{group_by()} is applied automatically.
}
}
\section{Detecting design variable modification}{

If the left-hand side of a mutation names a design variable (e.g.,
\code{mutate(d, wt = wt * 2)}), a \code{surveytidy_warning_mutate_design_var} warning
is issued. Detection is name-based — \code{across()} calls that happen to
modify design variables will \strong{not} trigger the warning.
}

\examples{
library(dplyr)
df <- data.frame(y = rnorm(100), wt = runif(100, 1, 5),
                 g = sample(c("A","B"), 100, TRUE))
d  <- surveycore::as_survey(df, weights = wt)

# Add a new column
d2 <- mutate(d, y_sq = y^2)

# Grouped mutate
d3 <- d |>
  group_by(g) |>
  mutate(g_mean = mean(y))

}
\seealso{
\code{\link[=rename]{rename()}} to rename columns, \code{\link[=select]{select()}} to drop columns

Other modification: 
\code{\link{rename.survey_base}()}
}
\concept{modification}
